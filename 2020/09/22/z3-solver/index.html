<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>z3-solver | Risuxx's blog</title><meta name="description" content="简介 z3是微软最新的可满足模理论(SMT)求解器。它可以使用一个或者多个理论来检查逻辑公式的可满足性。(以下脚本不是python脚本) https:&#x2F;&#x2F;github.com&#x2F;Z3prover&#x2F;z3.git z3 script 基础命令 使用echo回显信息 1(echo &quot;starting z3...&quot;) 声明指定类型的常量，这里声明了Int类型的a 1(declare-cons"><meta name="keywords" content="ctf"><meta name="author" content="Risuxx"><meta name="copyright" content="Risuxx"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="z3-solver"><meta name="twitter:description" content="简介 z3是微软最新的可满足模理论(SMT)求解器。它可以使用一个或者多个理论来检查逻辑公式的可满足性。(以下脚本不是python脚本) https:&#x2F;&#x2F;github.com&#x2F;Z3prover&#x2F;z3.git z3 script 基础命令 使用echo回显信息 1(echo &quot;starting z3...&quot;) 声明指定类型的常量，这里声明了Int类型的a 1(declare-cons"><meta name="twitter:image" content="http://img.ewebweb.com/uploads/20200102/21/1577972389-nWFADxoCrg.jpeg"><meta property="og:type" content="article"><meta property="og:title" content="z3-solver"><meta property="og:url" content="https://risuxx.github.io/2020/09/22/z3-solver/"><meta property="og:site_name" content="Risuxx's blog"><meta property="og:description" content="简介 z3是微软最新的可满足模理论(SMT)求解器。它可以使用一个或者多个理论来检查逻辑公式的可满足性。(以下脚本不是python脚本) https:&#x2F;&#x2F;github.com&#x2F;Z3prover&#x2F;z3.git z3 script 基础命令 使用echo回显信息 1(echo &quot;starting z3...&quot;) 声明指定类型的常量，这里声明了Int类型的a 1(declare-cons"><meta property="og:image" content="http://img.ewebweb.com/uploads/20200102/21/1577972389-nWFADxoCrg.jpeg"><meta property="article:published_time" content="2020-09-22T00:30:50.000Z"><meta property="article:modified_time" content="2020-09-28T03:58:43.279Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://risuxx.github.io/2020/09/22/z3-solver/"><link rel="prev" title="reverse_3" href="https://risuxx.github.io/2020/10/04/reverse-3/"><link rel="next" title="battlefield" href="https://risuxx.github.io/2020/09/10/battlefield/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#z3-script"><span class="toc-number">2.</span> <span class="toc-text">z3 script</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础命令"><span class="toc-number">2.1.</span> <span class="toc-text">基础命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用视图"><span class="toc-number">2.2.</span> <span class="toc-text">使用视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">2.3.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他命令"><span class="toc-number">2.4.</span> <span class="toc-text">其他命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运算"><span class="toc-number">2.5.</span> <span class="toc-text">运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非线性运算"><span class="toc-number">2.6.</span> <span class="toc-text">非线性运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#除法"><span class="toc-number">2.7.</span> <span class="toc-text">除法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitvectors"><span class="toc-number">2.8.</span> <span class="toc-text">Bitvectors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基础bitvector运算"><span class="toc-number">2.9.</span> <span class="toc-text">基础Bitvector运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitwise-operations位操作"><span class="toc-number">2.10.</span> <span class="toc-text">Bitwise Operations(位操作)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitvectors的比较"><span class="toc-number">2.11.</span> <span class="toc-text">Bitvectors的比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arrays"><span class="toc-number">2.12.</span> <span class="toc-text">Arrays</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数组上的映射函数"><span class="toc-number">2.13.</span> <span class="toc-text">数组上的映射函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python"><span class="toc-number">3.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#solvers"><span class="toc-number">3.1.</span> <span class="toc-text">Solvers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#算术运算"><span class="toc-number">3.2.</span> <span class="toc-text">算术运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大数运算"><span class="toc-number">3.3.</span> <span class="toc-text">大数运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#机器运算"><span class="toc-number">3.4.</span> <span class="toc-text">机器运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数"><span class="toc-number">3.5.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可满足性和有效性"><span class="toc-number">3.6.</span> <span class="toc-text">可满足性和有效性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-comprehension"><span class="toc-number">3.7.</span> <span class="toc-text">List comprehension</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运动学方程"><span class="toc-number">3.8.</span> <span class="toc-text">运动学方程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bit-tricks"><span class="toc-number">3.9.</span> <span class="toc-text">Bit Tricks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#puzzles"><span class="toc-number">3.10.</span> <span class="toc-text">Puzzles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用安装问题"><span class="toc-number">3.11.</span> <span class="toc-text">应用：安装问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对于同余方程"><span class="toc-number">4.</span> <span class="toc-text">对于同余方程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://img.ewebweb.com/uploads/20200102/21/1577972389-nWFADxoCrg.jpeg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Risuxx's blog</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">z3-solver</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-09-22 08:30:50"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-09-22</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-09-28 11:58:43"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-09-28</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="简介">简介</h2>
<p>z3是微软最新的可满足模理论(SMT)求解器。它可以使用一个或者多个理论来检查逻辑公式的可满足性。(以下脚本不是python脚本)</p>
<p><a href="https://github.com/Z3Prover/z3.git" target="_blank" rel="noopener">https://github.com/Z3prover/z3.git</a></p>
<h2 id="z3-script">z3 script</h2>
<h3 id="基础命令">基础命令</h3>
<p>使用<code>echo</code>回显信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(echo <span class="string">"starting z3..."</span>)</span><br></pre></td></tr></table></figure>
<p>声明指定类型的常量，这里声明了Int类型的a</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br></pre></td></tr></table></figure>
<p>声明函数，这里声明了一个接收整数和布尔变量并且返回整数的函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(declare-fun f (Int Bool) Int)</span><br></pre></td></tr></table></figure>
<p><code>assert</code>可以添加公式到z3的内部栈中。假如有一个令所有声明公式都为真的解，那么我们成这些在z3栈中的公式是具有可满足性的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br><span class="line">(declare-fun f (Int Bool) Int)</span><br><span class="line">(<span class="keyword">assert</span> (&gt; a <span class="number">10</span>))</span><br><span class="line">(<span class="keyword">assert</span> (&lt; (f a true) <span class="number">100</span>))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<p>第一个声明公式表明<code>a &gt; 10</code>。第二个声明公式表示函数<code>f</code>必须接收<code>a</code>和<code>true</code>作为传入参数，并且返回值要小于<code>100</code>。<code>check-sat</code>会说明当前在z3栈中的公式是否具有可满足性，假如具有会返回<code>sat</code>，否则返回<code>unsat</code>，有时候也会返回<code>unknown</code>，这说明z3不能确定公式是否是可满足的。</p>
<p><code>get-model</code>能够获取一个解，上述脚本的返回值如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sat</span><br><span class="line">(model </span><br><span class="line">  (define-fun a () Int</span><br><span class="line">    <span class="number">11</span>)</span><br><span class="line">  (define-fun f ((x!<span class="number">1</span> Int) (x!<span class="number">2</span> Bool)) Int</span><br><span class="line">    (ite (<span class="keyword">and</span> (= x!<span class="number">1</span> <span class="number">11</span>) (= x!<span class="number">2</span> true)) <span class="number">0</span></span><br><span class="line">      <span class="number">0</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这个模型的意思是，a的值是11，对于f，传入参数有两个变量，一个是<code>x!1</code>为整数，另一个是<code>x!2</code>为布尔值。<code>ite</code>为if-else语句，当<code>x!1</code>等于11并且<code>x!2</code>为真时返回前一个0，否则返回后一个0。</p>
<h3 id="使用视图">使用视图</h3>
<p>我们可以使用<code>push</code>和<code>pop</code>来将全局栈重点声明和断言传入当前栈中。push和pop是相匹配的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(declare-const x Int)</span><br><span class="line">(declare-const y Int)</span><br><span class="line">(declare-const z Int)</span><br><span class="line">(push)</span><br><span class="line">(<span class="keyword">assert</span> (= (+ x y) <span class="number">10</span>))</span><br><span class="line">(<span class="keyword">assert</span> (= (+ x (* <span class="number">2</span> y)) <span class="number">20</span>))</span><br><span class="line">(check-sat)</span><br><span class="line">(pop) ; remove the two assertions</span><br><span class="line">(push) </span><br><span class="line">(<span class="keyword">assert</span> (= (+ (* <span class="number">3</span> x) y) <span class="number">10</span>))</span><br><span class="line">(<span class="keyword">assert</span> (= (+ (* <span class="number">2</span> x) (* <span class="number">2</span> y)) <span class="number">21</span>))</span><br><span class="line">(check-sat)</span><br><span class="line">(pop)</span><br><span class="line">(declare-const p Bool)</span><br><span class="line">(<span class="keyword">assert</span> p) ; error, since declaration of p was removed <span class="keyword">from</span> the stack</span><br></pre></td></tr></table></figure>
<p>返回值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sat</span><br><span class="line">unsat</span><br></pre></td></tr></table></figure>
<h3 id="配置">配置</h3>
<p><code>set-option</code>被用来配置z3。有一些选项只能在一开始被设置。我们可以使用<code>reset</code>命令去消除所有的声明和断言。在使用<code>reset</code>之后所有的配置选项都能被设置了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(set-option :<span class="keyword">print</span>-success true) </span><br><span class="line">(set-option :produce-unsat-cores true) ; enable generation of unsat cores</span><br><span class="line">(set-option :produce-models true) ; enable model generation</span><br><span class="line">(set-option :produce-proofs true) ; enable proof generation</span><br><span class="line">(declare-const x Int)</span><br><span class="line">(set-option :produce-proofs false) ; error, cannot change this option after a declaration <span class="keyword">or</span> assertion</span><br><span class="line">(echo <span class="string">"before reset"</span>)</span><br><span class="line">(reset)</span><br><span class="line">(set-option :produce-proofs false) ; ok</span><br></pre></td></tr></table></figure>
<p>选项<code>print-success</code>通常在z3被另一个使用pipe的应用程序控制时特别有用。在这个模式下，那些不输出任何值的命令将打印<code>success</code></p>
<h3 id="其他命令">其他命令</h3>
<p><code>display t</code>可以打印表达式。<code>simplify t</code>会打印一个可能是与<code>t</code>等价但是更简单的表达式。<code>help simplify</code>可以看到所有的可用选项。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a (Array Int Int))</span><br><span class="line">(declare-const x Int)</span><br><span class="line">(declare-const y Int)</span><br><span class="line">(display (+ x <span class="number">2</span> x <span class="number">1</span>))</span><br><span class="line">(simplify (+ x <span class="number">2</span> x <span class="number">1</span>))</span><br><span class="line">(simplify (* (+ x y) (+ x y)))</span><br><span class="line">(simplify (* (+ x y) (+ x y)) :som true) ; put all expressions <span class="keyword">in</span> sum-of-monomials form.</span><br><span class="line">(simplify (= x (+ y <span class="number">2</span>)) :arith-lhs true)</span><br><span class="line">(simplify (= (store (store a <span class="number">1</span> <span class="number">2</span>) <span class="number">4</span> <span class="number">3</span>)</span><br><span class="line">             (store (store a <span class="number">4</span> <span class="number">3</span>) <span class="number">1</span> <span class="number">2</span>)))</span><br><span class="line">(simplify (= (store (store a <span class="number">1</span> <span class="number">2</span>) <span class="number">4</span> <span class="number">3</span>)</span><br><span class="line">             (store (store a <span class="number">4</span> <span class="number">3</span>) <span class="number">1</span> <span class="number">2</span>))</span><br><span class="line">          :sort-store true)</span><br><span class="line">(help simplify)</span><br></pre></td></tr></table></figure>
<p>sort命令定义了一个新的排序符号，该符号是排序表达式的缩写。可以参数化新的排序符号，在这种情况下，参数的名称在命令中指定，排序表达式使用排序参数。命令的形式是这样的。（sort：the arrangement of data in a prescribed sequence）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(define-sort [symbol] ([symbol]+) [sort])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(define-sort Set (T) (Array T Bool))</span><br><span class="line">(define-sort IList () (List Int))</span><br><span class="line">(define-sort List-Set (T) (Array (List T) Bool))</span><br><span class="line">(define-sort I () Int)</span><br><span class="line"></span><br><span class="line">(declare-const s1 (Set I))</span><br><span class="line">(declare-const s2 (List-Set Int))</span><br><span class="line">(declare-const a I)</span><br><span class="line">(declare-const l IList)</span><br><span class="line"></span><br><span class="line">(<span class="keyword">assert</span> (= (select s1 a) true))</span><br><span class="line">(<span class="keyword">assert</span> (= (select s2 l) false))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<h3 id="运算">运算</h3>
<p>z3有对整数和实数的内建支持。这两种类型与机器整数（32位或64位）和浮点数不同。这两种类型(sorts)表示数学整数和实数。<code>declare-const</code>用于声明整型和实数常量。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br><span class="line">(declare-const b Int)</span><br><span class="line">(declare-const c Int)</span><br><span class="line">(declare-const d Real)</span><br><span class="line">(declare-const e Real)</span><br></pre></td></tr></table></figure>
<p>在声明常量之后，用户可以使用断言，包含这些常数的smt公式。公式包含算术运算符 。<code>check-sat</code>将找到一个解。该解可以通过<code>get-model</code>来获得。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br><span class="line">(declare-const b Int)</span><br><span class="line">(declare-const c Int)</span><br><span class="line">(declare-const d Real)</span><br><span class="line">(declare-const e Real)</span><br><span class="line">(<span class="keyword">assert</span> (&gt; a (+ b <span class="number">2</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (= a (+ (* <span class="number">2</span> c) <span class="number">10</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (&lt;= (+ c b) <span class="number">1000</span>))</span><br><span class="line">(<span class="keyword">assert</span> (&gt;= d e))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<p>实数常量需要包含一个小数点。和大多数的编程语言不同，z3不会自动的将整数转化为实数，反之亦然。<code>to-real</code>可以用于将整数表达式转换为实数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br><span class="line">(declare-const b Int)</span><br><span class="line">(declare-const c Int)</span><br><span class="line">(declare-const d Real)</span><br><span class="line">(declare-const e Real)</span><br><span class="line">(<span class="keyword">assert</span> (&gt; e (+ (to_real (+ a b)) <span class="number">2.0</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (= d (+ (to_real c) <span class="number">0.5</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (&gt; a b))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<h3 id="非线性运算">非线性运算</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br><span class="line">(<span class="keyword">assert</span> (&gt; (* a a) <span class="number">3</span>))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br><span class="line"></span><br><span class="line">(echo <span class="string">"Z3 does not always find solutions to non-linear problems"</span>)</span><br><span class="line">(declare-const b Real)</span><br><span class="line">(declare-const c Real)</span><br><span class="line">(<span class="keyword">assert</span> (= (+ (* b b b) (* b c)) <span class="number">3.0</span>))</span><br><span class="line">(check-sat)</span><br><span class="line"></span><br><span class="line">(echo <span class="string">"yet it can show unsatisfiabiltiy for some nontrivial nonlinear problems..."</span>)</span><br><span class="line">(declare-const x Real)</span><br><span class="line">(declare-const y Real)</span><br><span class="line">(declare-const z Real)</span><br><span class="line">(<span class="keyword">assert</span> (= (* x x) (+ x <span class="number">2.0</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (= (* x y) x))</span><br><span class="line">(<span class="keyword">assert</span> (= (* (- y <span class="number">1.0</span>) z) <span class="number">1.0</span>))</span><br><span class="line">(check-sat)</span><br><span class="line"></span><br><span class="line">(reset)</span><br><span class="line">(echo <span class="string">"When presented only non-linear constraints over reals, Z3 uses a specialized complete solver"</span>)</span><br><span class="line">(declare-const b Real)</span><br><span class="line">(declare-const c Real)</span><br><span class="line">(<span class="keyword">assert</span> (= (+ (* b b b) (* b c)) <span class="number">3.0</span>))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<h3 id="除法">除法</h3>
<p>z3也支持除法、整数除法、模和余数运算符。在内部，它们都会映射到乘法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(declare-const a Int)</span><br><span class="line">(declare-const r1 Int)</span><br><span class="line">(declare-const r2 Int)</span><br><span class="line">(declare-const r3 Int)</span><br><span class="line">(declare-const r4 Int)</span><br><span class="line">(declare-const r5 Int)</span><br><span class="line">(declare-const r6 Int)</span><br><span class="line">(<span class="keyword">assert</span> (= a <span class="number">10</span>))</span><br><span class="line">(<span class="keyword">assert</span> (= r1 (div a <span class="number">4</span>))) ; integer division</span><br><span class="line">(<span class="keyword">assert</span> (= r2 (mod a <span class="number">3</span>))) ; mod</span><br><span class="line">(<span class="keyword">assert</span> (= r3 (rem a <span class="number">3</span>))) ; remainder</span><br><span class="line">(<span class="keyword">assert</span> (= r4 (div a (- <span class="number">4</span>)))) ; integer division</span><br><span class="line">(<span class="keyword">assert</span> (= r5 (mod a (- <span class="number">4</span>)))) ; mod</span><br><span class="line">(<span class="keyword">assert</span> (= r6 (rem a (- <span class="number">4</span>)))) ; remainder</span><br><span class="line">(declare-const b Real)</span><br><span class="line">(declare-const c Real)</span><br><span class="line">(<span class="keyword">assert</span> (&gt;= b (/ c <span class="number">3.0</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (&gt;= c <span class="number">20.0</span>))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<p>在z3中，允许0作为除数，但是该运算没有特殊的结果。除法不是一个部分函数。实际上，z3中所有的函数都是总和，尽管在某些情况下，比如除0，结果可能没有被指定。rem与mod的区别在负数的时候体现。</p>
<h3 id="bitvectors">Bitvectors</h3>
<p>现代cpu和主流的编程语言会在固定大小的向量位上使用算术。</p>
<p>z3支持任意大小的位向量。</p>
<p>z3支持任意大小的位向量。(_ BitVec n)是长度为n的一种位向量。位向量文字可以使用二进制、十进制和十六进制表示法来定义。在二进制和十六进制情况下，位向量的大小是从字符数推断出来的。例如，二进制格式的位向量文字#b010是一个大小为3的位向量，而十六进制格式的位向量文字#x0a0是一个大小为12的位向量。对于十进制格式的位向量文字，必须指定其大小。例如，(_ bv10 32)是一个大小为32的位向量，它表示数字10。默认情况下，如果位向量大小是4的倍数，z3以十六进制格式显示位向量，否则以二进制格式显示。命令(设置选项:pp。可用于强制z3以十进制格式显示位向量字面值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(display <span class="comment">#b0100)</span></span><br><span class="line">(display (_ bv20 <span class="number">8</span>))</span><br><span class="line">(display (_ bv20 <span class="number">7</span>))</span><br><span class="line">(display <span class="comment">#x0a) </span></span><br><span class="line">(set-option :pp.bv-literals false)</span><br><span class="line">(display <span class="comment">#b0100)</span></span><br><span class="line">(display (_ bv20 <span class="number">8</span>))</span><br><span class="line">(display (_ bv20 <span class="number">7</span>))</span><br><span class="line">(display <span class="comment">#x0a)</span></span><br></pre></td></tr></table></figure>
<h3 id="基础bitvector运算">基础Bitvector运算</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(simplify (bvadd <span class="comment">#x07 #x03)) ; addition</span></span><br><span class="line">(simplify (bvsub <span class="comment">#x07 #x03)) ; subtraction</span></span><br><span class="line">(simplify (bvneg <span class="comment">#x07)) ; unary minus</span></span><br><span class="line">(simplify (bvmul <span class="comment">#x07 #x03)) ; multiplication</span></span><br><span class="line">(simplify (bvurem <span class="comment">#x07 #x03)) ; unsigned remainder</span></span><br><span class="line">(simplify (bvsrem <span class="comment">#x07 #x03)) ; signed remainder</span></span><br><span class="line">(simplify (bvsmod <span class="comment">#x07 #x03)) ; signed modulo</span></span><br><span class="line">(simplify (bvshl <span class="comment">#x07 #x03)) ; shift left</span></span><br><span class="line">(simplify (bvlshr <span class="comment">#xf0 #x03)) ; unsigned (logical) shift right</span></span><br><span class="line">(simplify (bvashr <span class="comment">#xf0 #x03)) ; signed (arithmetical) shift right</span></span><br></pre></td></tr></table></figure>
<h3 id="bitwise-operations位操作">Bitwise Operations(位操作)</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(simplify (bvor <span class="comment">#x6 #x3))   ; bitwise or</span></span><br><span class="line">(simplify (bvand <span class="comment">#x6 #x3))  ; bitwise and</span></span><br><span class="line">(simplify (bvnot <span class="comment">#x6)) ; bitwise not</span></span><br><span class="line">(simplify (bvnand <span class="comment">#x6 #x3)) ; bitwise nand</span></span><br><span class="line">(simplify (bvnor <span class="comment">#x6 #x3)) ; bitwise nor</span></span><br><span class="line">(simplify (bvxnor <span class="comment">#x6 #x3)) ; bitwise xnor</span></span><br></pre></td></tr></table></figure>
<p>有一种快速的方法可以检验固定大小的数是否为2的幂。当且仅当x&amp;(x-1)为0时，位向量x是2的幂或0，其中&amp;表示位与。</p>
<h3 id="bitvectors的比较">Bitvectors的比较</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(simplify (bvule <span class="comment">#x0a #xf0))  ; unsigned less or equal</span></span><br><span class="line">(simplify (bvult <span class="comment">#x0a #xf0))  ; unsigned less than</span></span><br><span class="line">(simplify (bvuge <span class="comment">#x0a #xf0))  ; unsigned greater or equal</span></span><br><span class="line">(simplify (bvugt <span class="comment">#x0a #xf0))  ; unsigned greater than</span></span><br><span class="line">(simplify (bvsle <span class="comment">#x0a #xf0))  ; signed less or equal</span></span><br><span class="line">(simplify (bvslt <span class="comment">#x0a #xf0))  ; signed less than</span></span><br><span class="line">(simplify (bvsge <span class="comment">#x0a #xf0))  ; signed greater or equal</span></span><br><span class="line">(simplify (bvsgt <span class="comment">#x0a #xf0))  ; signed greater than</span></span><br></pre></td></tr></table></figure>
<p>有符号比较，例如bvsle，将位向量的符号位考虑到比较中，而无符号比较将位向量视为无符号比较(将位向量视为自然数)。</p>
<h3 id="arrays">Arrays</h3>
<p>作为数学计算理论程序的一部分，McCarthy提出了阵列的基本理论，其特征是选择-存储公理。表达式<code>select a i</code>返回在<code>a</code>中<code>i</code>这个位置上的值，<code>store a i v</code>返回一个在<code>i</code>的位置上值为<code>v</code>的新array</p>
<p>让我们先检查数组的一个基本属性。假设<code>a1</code>是一个整数数组，那么约束<code>(and (= (select a1 x) x) (= (store a1 x y) a1))</code>是可满足的，因为当<code>x=y</code>时，第一个等式迫使位置<code>x</code>上的值为<code>x</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(declare-const x Int)</span><br><span class="line">(declare-const y Int)</span><br><span class="line">(declare-const z Int)</span><br><span class="line">(declare-const a1 (Array Int Int))</span><br><span class="line">(declare-const a2 (Array Int Int))</span><br><span class="line">(declare-const a3 (Array Int Int))</span><br><span class="line">(<span class="keyword">assert</span> (= (select a1 x) x))</span><br><span class="line">(<span class="keyword">assert</span> (= (store a1 x y) a1))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br></pre></td></tr></table></figure>
<p>常量数组，可以在z3中使用const构造所有位置上均为同一个值的数组。下面的示例定义了一个仅包含1的常量数组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(declare-const all1 (Array Int Int))</span><br><span class="line">(declare-const a Int)</span><br><span class="line">(declare-const i Int)</span><br><span class="line">(<span class="keyword">assert</span> (= all1 ((<span class="keyword">as</span> const (Array Int Int)) <span class="number">1</span>)))</span><br><span class="line">(<span class="keyword">assert</span> (= a (select all1 i)))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br><span class="line">(<span class="keyword">assert</span> (<span class="keyword">not</span> (= a <span class="number">1</span>)))</span><br><span class="line">(check-sat)</span><br></pre></td></tr></table></figure>
<p>model如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sat</span><br><span class="line">(model </span><br><span class="line">  (define-fun all1 () (Array Int Int)</span><br><span class="line">    (_ <span class="keyword">as</span>-array k!<span class="number">0</span>))</span><br><span class="line">  (define-fun i () Int</span><br><span class="line">    <span class="number">0</span>)</span><br><span class="line">  (define-fun a () Int</span><br><span class="line">    <span class="number">1</span>)</span><br><span class="line">  (define-fun k!<span class="number">0</span> ((x!<span class="number">1</span> Int)) Int</span><br><span class="line">    (ite (= x!<span class="number">1</span> <span class="number">0</span>) <span class="number">1</span></span><br><span class="line">      <span class="number">1</span>))</span><br><span class="line">)</span><br><span class="line">unsat</span><br></pre></td></tr></table></figure>
<p>模型提供了可满足公式中出现的自由常数和函数的解释。数组的解释与函数的解释非常相似。z3使用结构(_ as-array f)对arrays进行解释。假如数组a等于(_ as-array f)，那么对于每个索引i，(select a i)都等于(f i)。对数组常量all1进行解释。</p>
<h3 id="数组上的映射函数">数组上的映射函数</h3>
<p>下面，我们将使用z3中的数组理论扩展来模拟基本的布尔代数(集合理论)。z3提供了数组上的参数化映射函数。它允许在数组范围内应用任意函数。下面的示例演示如何使用map函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(define-sort Set (T) (Array T Bool))</span><br><span class="line">(declare-const a (Set Int))</span><br><span class="line">(declare-const b (Set Int))</span><br><span class="line">(declare-const c (Set Int))</span><br><span class="line">(declare-const x Int)</span><br><span class="line">(push)</span><br><span class="line">(<span class="keyword">assert</span> (<span class="keyword">not</span> (= ((_ map <span class="keyword">and</span>) a b) ((_ map <span class="keyword">not</span>) ((_ map <span class="keyword">or</span>) ((_ map <span class="keyword">not</span>) b) ((_ map <span class="keyword">not</span>) a))))))</span><br><span class="line">(check-sat)</span><br><span class="line">(pop)</span><br><span class="line">(push) </span><br><span class="line">(<span class="keyword">assert</span> (<span class="keyword">and</span> (select ((_ map <span class="keyword">and</span>) a b) x) (<span class="keyword">not</span> (select a x))))</span><br><span class="line">(check-sat)</span><br><span class="line">(pop)</span><br><span class="line">(push) </span><br><span class="line">(<span class="keyword">assert</span> (<span class="keyword">and</span> (select ((_ map <span class="keyword">or</span>) a b) x) (<span class="keyword">not</span> (select a x))))</span><br><span class="line">(check-sat)</span><br><span class="line">(get-model)</span><br><span class="line">(<span class="keyword">assert</span> (<span class="keyword">and</span> (<span class="keyword">not</span> (select b x))))</span><br><span class="line">(check-sat)</span><br></pre></td></tr></table></figure>
<h2 id="python">python</h2>
<p>示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">y = Real(<span class="string">'y'</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(x + y &gt; <span class="number">5</span>, x &gt; <span class="number">1</span>, y &gt; <span class="number">1</span>)</span><br><span class="line">print(s.check())</span><br><span class="line">print(s.model())</span><br></pre></td></tr></table></figure>
<p>让我们从下面这个简单的例子开始</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">solve(x &gt; <span class="number">2</span>, y &lt; <span class="number">10</span>, x + <span class="number">2</span>*y == <span class="number">7</span>)</span><br></pre></td></tr></table></figure>
<p>函数<code>Int('x')</code>创建了一个整型变量x。<code>solve</code>函数用来求解这些限制。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">print(simplify(x + y + <span class="number">2</span>*x + <span class="number">3</span>))</span><br><span class="line">print(simplify(x &lt; y + x + <span class="number">2</span>))</span><br><span class="line">print(simplify(And(x + <span class="number">1</span> &gt;= <span class="number">3</span>, x**<span class="number">2</span> + x**<span class="number">2</span> + y**<span class="number">2</span> + <span class="number">2</span> &gt;= <span class="number">5</span>)))</span><br></pre></td></tr></table></figure>
<p><code>simplify</code>用来化简公式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">print(x**<span class="number">2</span> + y**<span class="number">2</span> &gt;= <span class="number">1</span>)</span><br><span class="line">set_option(html_mode=<span class="literal">False</span>)</span><br><span class="line">print(x**<span class="number">2</span> + y**<span class="number">2</span> &gt;= <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>html_mode为假时将不会用html语言的形式来呈现结果，这也是默认模式。</p>
<p>Z3提供了遍历表达式的函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">n = x + y &gt;= <span class="number">3</span></span><br><span class="line">print(<span class="string">"num args: "</span>, n.num_args())</span><br><span class="line">print(<span class="string">"children: "</span>, n.children())</span><br><span class="line">print(<span class="string">"1st child:"</span>, n.arg(<span class="number">0</span>))</span><br><span class="line">print(<span class="string">"2nd child:"</span>, n.arg(<span class="number">1</span>))</span><br><span class="line">print(<span class="string">"operator: "</span>, n.decl())</span><br><span class="line">print(<span class="string">"op name:  "</span>, n.decl().name())</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">num args:  2</span><br><span class="line">children:  [x + y, 3]</span><br><span class="line">1st child: x + y</span><br><span class="line">2nd child: 3</span><br><span class="line">operator:  &amp;ge;</span><br><span class="line">op name:   &gt;&#x3D;</span><br></pre></td></tr></table></figure>
<p>Z3Py可以解非线性约束。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">y = Real(<span class="string">'y'</span>)</span><br><span class="line">solve(x**<span class="number">2</span> + <span class="number">0.12</span> * y**<span class="number">2</span> &gt; <span class="number">3</span>, x**<span class="number">3</span> + y &lt; <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>可以使用<code>set_option(precision=30)</code>来决定精度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">y = Real(<span class="string">'y'</span>)</span><br><span class="line">solve(x**<span class="number">2</span> + y**<span class="number">2</span> == <span class="number">3</span>, x**<span class="number">3</span> == <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">set_option(precision=<span class="number">30</span>)</span><br><span class="line">print(<span class="string">"Solving, and displaying result with 30 decimal places"</span>)</span><br><span class="line">solve(x**<span class="number">2</span> + y**<span class="number">2</span> == <span class="number">3</span>, x**<span class="number">3</span> == <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[x &#x3D; 1.2599210498?, y &#x3D; -1.1885280594?]</span><br><span class="line">Solving, and displaying result with 30 decimal places</span><br><span class="line">[x &#x3D; 1.259921049894873164767210607278?,</span><br><span class="line"> y &#x3D; -1.188528059421316533710369365015?]</span><br></pre></td></tr></table></figure>
<p>输出中的?表示数字被截断</p>
<p>可以使用<code>set_option(rational_to_decimal=True)</code>来设置输出的格式</p>
<figure>
<img src="/2020/09/22/z3-solver/image-20200924203437160.png" alt><figcaption>image-20200924203437160</figcaption>
</figure>
<p>可以使用布尔逻辑运算，z3支持与(and)，或(or)，非(not)，蕴含(implies)，if(if-then-else)，与等于</p>
<p>a implies b 就是如果a，那么b，即if a == True, then b == True</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p = Bool(<span class="string">'p'</span>)</span><br><span class="line">q = Bool(<span class="string">'q'</span>)</span><br><span class="line">r = Bool(<span class="string">'r'</span>)</span><br><span class="line">solve(Implies(p, q), r == Not(q), Or(Not(p), r))</span><br></pre></td></tr></table></figure>
<h3 id="solvers">Solvers</h3>
<p>该类可以使用原始的z3方法，例如前文提到的check， push， pop</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">s.add(x &gt; <span class="number">10</span>, y == x + <span class="number">2</span>)</span><br><span class="line">print(s)</span><br><span class="line">print(<span class="string">"Solving constraints in the solver s ..."</span>)</span><br><span class="line">print(s.check())</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Create a new scope..."</span>)</span><br><span class="line">s.push()</span><br><span class="line">s.add(y &lt; <span class="number">11</span>)</span><br><span class="line">print(s)</span><br><span class="line">print(<span class="string">"Solving updated set of constraints..."</span>)</span><br><span class="line">print(s.check())</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Restoring state..."</span>)</span><br><span class="line">s.pop()</span><br><span class="line">print(s)</span><br><span class="line">print(<span class="string">"Solving restored set of constraints..."</span>)</span><br><span class="line">print(s.check())</span><br></pre></td></tr></table></figure>
<p>下面的例子展示了检视模型使用基本方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x, y, z = Reals(<span class="string">'x y z'</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(x &gt; <span class="number">1</span>, y &gt; <span class="number">1</span>, x + y &gt; <span class="number">3</span>, z - x &lt; <span class="number">10</span>)</span><br><span class="line">print(s.check())</span><br><span class="line"></span><br><span class="line">m = s.model()</span><br><span class="line">print(<span class="string">"x = %s"</span> % m[x])</span><br><span class="line"></span><br><span class="line">print(<span class="string">"traversing model..."</span>)</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> m.decls():</span><br><span class="line">    print(<span class="string">"%s = %s"</span> % (d.name(), m[d]))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sat</span><br><span class="line">x &#x3D; 3&#x2F;2</span><br><span class="line">traversing model...</span><br><span class="line">z &#x3D; 0</span><br><span class="line">y &#x3D; 2</span><br><span class="line">x &#x3D; 3&#x2F;2</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，<code>Reals('x y z')</code>同时创建了变量<code>x</code>，<code>y</code>，<code>z</code></p>
<p><code>m[x]</code>返回模型<code>m</code>中<code>x</code>的值。</p>
<h3 id="算术运算">算术运算</h3>
<p>z3支持实数与整数变量。他们能够在同一个问题中混用。和大多数编程语言一样，z3能够在需要的时候将整数表达式自动转成实数。下面的例子证明了声明整数和实数变量的不同方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = Real(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">a, b, c = Reals(<span class="string">'a b c'</span>)</span><br><span class="line">s, r = Ints(<span class="string">'s r'</span>)</span><br><span class="line">print(x + y + <span class="number">1</span> + (a + s))</span><br><span class="line">print(ToReal(y) + c)</span><br></pre></td></tr></table></figure>
<p><code>ToReal</code>方法可以将整数表达式编程实数表达式。z3Py支持所有的基础算术运算符。</p>
<p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a, b, c = Ints(<span class="string">'a b c'</span>)</span><br><span class="line">d, e = Reals(<span class="string">'d e'</span>)</span><br><span class="line">solve(a &gt; b + <span class="number">2</span>,</span><br><span class="line">      a == <span class="number">2</span>*c + <span class="number">10</span>,</span><br><span class="line">      c + b &lt;= <span class="number">1000</span>,</span><br><span class="line">      d &gt;= e)</span><br></pre></td></tr></table></figure>
<p><code>simplify</code>可以化简表达式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x, y = Reals(<span class="string">'x y'</span>)</span><br><span class="line"><span class="comment"># Put expression in sum-of-monomials form</span></span><br><span class="line">t = simplify((x + y)**<span class="number">3</span>, som=<span class="literal">True</span>)</span><br><span class="line">print(t)</span><br><span class="line"><span class="comment"># Use power operator</span></span><br><span class="line">t = simplify(t, mul_to_power=<span class="literal">True</span>)</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>
<p>化简式有两种展示风格。z3内部的选项名称用<code>-</code>分割各个单词。这些选项也能够在z3Py中使用。z3Py也支持Python风格的选项名称。这种风格里使用<code>_</code>来代替<code>-</code>，下面的例子展示这两种不同的风格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x, y = Reals(<span class="string">'x y'</span>)</span><br><span class="line"><span class="comment"># Using Z3 native option names</span></span><br><span class="line">print(simplify(x == y + <span class="number">2</span>, <span class="string">':arith-lhs'</span>, <span class="literal">True</span>))</span><br><span class="line"><span class="comment"># Using Z3Py option names</span></span><br><span class="line">print(simplify(x == y + <span class="number">2</span>, arith_lhs=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"\nAll available options:"</span>)</span><br><span class="line">help_simplify()</span><br></pre></td></tr></table></figure>
<h3 id="大数运算">大数运算</h3>
<p>Z3Py支持大数运算。下面的例子说明了如何使用大整数、有理数、无理数进行基本算术运算。Z3Py只支持代数无理数运算。它将会用小数形式去展示无理数。内建表达可以用<code>sexpr()</code>方法去提取。它将会展示Lisp风格的表达式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x, y = Reals(<span class="string">'x y'</span>)</span><br><span class="line">solve(x + <span class="number">10000000000000000000000</span> == y, y &gt; <span class="number">20000000000000000</span>)</span><br><span class="line"></span><br><span class="line">print(Sqrt(<span class="number">2</span>) + Sqrt(<span class="number">3</span>))</span><br><span class="line">print(simplify(Sqrt(<span class="number">2</span>) + Sqrt(<span class="number">3</span>)))</span><br><span class="line">print(simplify(Sqrt(<span class="number">2</span>) + Sqrt(<span class="number">3</span>)).sexpr())</span><br><span class="line"><span class="comment"># The sexpr() method is available for any Z3 expression</span></span><br><span class="line">print((x + Sqrt(y) * <span class="number">2</span>).sexpr())</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[y &#x3D; 20000000000000001, x &#x3D; -9999979999999999999999]</span><br><span class="line">2&lt;sup&gt;1&#x2F;2&lt;&#x2F;sup&gt; + 3&lt;sup&gt;1&#x2F;2&lt;&#x2F;sup&gt;</span><br><span class="line">3.146264369941972342329135065715?</span><br><span class="line">(root-obj (+ (^ x 4) (* (- 10) (^ x 2)) 1) 4)</span><br><span class="line">(+ x (* (^ y (&#x2F; 1.0 2.0)) 2.0))</span><br></pre></td></tr></table></figure>
<h3 id="机器运算">机器运算</h3>
<p>现代CPU和主流编程语言使用定长比特向量来进行算术运算。机器运算在Z3Py中可以以Bit-Vetors的方式呈现。他们实现了无符号和有符号二补算术的精确语义。下面的示例演示展示了如何创建向量变量和常量。函数 <code>BitVec('x', 16)</code>创建了一个名字为<code>x</code>的16位的位向量 变量。也可以创建常量，<code>BitVecVal(10,32)</code>创建一个大小为32的位向量，值为10</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">x = BitVec(<span class="string">'x'</span>, <span class="number">16</span>)</span><br><span class="line">y = BitVec(<span class="string">'y'</span>, <span class="number">16</span>)</span><br><span class="line">print(x + <span class="number">2</span>)</span><br><span class="line"><span class="comment"># Internal representation</span></span><br><span class="line">print((x + <span class="number">2</span>).sexpr())</span><br><span class="line"></span><br><span class="line"><span class="comment"># -1 is equal to 65535 for 16-bit integers </span></span><br><span class="line">print(simplify(x + y - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating bit-vector constants</span></span><br><span class="line">a = BitVecVal(<span class="number">-1</span>, <span class="number">16</span>)</span><br><span class="line">b = BitVecVal(<span class="number">65535</span>, <span class="number">16</span>)</span><br><span class="line">print(simplify(a == b))</span><br><span class="line"></span><br><span class="line">a = BitVecVal(<span class="number">-1</span>, <span class="number">32</span>)</span><br><span class="line">b = BitVecVal(<span class="number">65535</span>, <span class="number">32</span>)</span><br><span class="line"><span class="comment"># -1 is not equal to 65535 for 32-bit integers </span></span><br><span class="line">print(simplify(a == b))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x + 2</span><br><span class="line">(bvadd x #x0002)</span><br><span class="line">65535 + x + y</span><br><span class="line">True</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<p>在C、C++、C#、Java中，作为数字的有符号位向量和无符号位向量之间没有区别。相反，z3提供了特殊的有符号版本的算术运算，它决定位向量是被有符号的方式处理还是被无符号的方式处理。在Z3Py中，运算符 &lt;, &lt;=, &gt;, &gt;=, /, %，&gt;&gt;对应于带符号的版本。对应的无符号算子是ULT、ULE、UGT、UGE、UDiv、URem、LShR</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create to bit-vectors of size 32</span></span><br><span class="line">x, y = BitVecs(<span class="string">'x y'</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">solve(x + y == <span class="number">2</span>, x &gt; <span class="number">0</span>, y &gt; <span class="number">0</span>)</span><br><span class="line"><span class="comment"># Bit-wise operators</span></span><br><span class="line"><span class="comment"># &amp; bit-wise and</span></span><br><span class="line"><span class="comment"># | bit-wise or</span></span><br><span class="line"><span class="comment"># ~ bit-wise not</span></span><br><span class="line">solve(x &amp; y == ~y)</span><br><span class="line"></span><br><span class="line">solve(x &lt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># using unsigned version of &lt; </span></span><br><span class="line">solve(ULT(x, <span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<h3 id="函数">函数</h3>
<p>不像编程语言，有副作用（side-effects）会抛出异常或者从不返回，z3中的函数没有副作用。它们定义了所有的输入值。这包括函数，比如除法。z3基于第一顺序的逻辑。</p>
<p>对于约束<code>x+y&gt;3</code>我们说<code>x、y</code>是变量。在很多教材上，<code>x、y</code>被称作未解释的常数。也就是这个约束允许对于任意解释<code>x+y&gt;3</code>恒成立。</p>
<p>更准确的说，函数和在第一顺序逻辑的常量符号是未解释的或自由的，也就是说没有一个被附加的先验解释。这与属于理论签名的函数相反，比如算术，函数<code>+</code>有一个固定的标准解释（它是两个数字的相加）。未解释函数和常数具有最大的灵活性，它们允许任何与函数或常数上的约束一致的解释。</p>
<p>为了说明未解释的函数和常量，让我们使用未解释的整型常量（也就是变量）x，y，最后让<code>f</code>是一个未解释的函数，它接收一个类型为整型（也就是sort）的参数并得到 一个整型值。这个例子说明了如何解释<code>f</code>对<code>x</code>应用一次与<code>x</code>不同。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">f = Function(<span class="string">'f'</span>, IntSort(), IntSort())</span><br><span class="line">solve(f(f(x)) == x, f(x) == y, x != y)</span><br><span class="line"></span><br><span class="line">[x = 0, y = 1, f = [1 -&gt; 0, else -&gt; 1]]</span><br></pre></td></tr></table></figure>
<p>这个解读作读作<code>f(0)=1,f(1)=0</code>，<code>f(a)</code>在0和1之外都是1。</p>
<p>在z3中，我们也可以计算模型中约束表达式。下面的例子中演示了如何使用<code>evaluate</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">f = Function(<span class="string">'f'</span>, IntSort(), IntSort())</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(f(f(x)) == x, f(x) == y, x != y)</span><br><span class="line">print(s.check())</span><br><span class="line">m = s.model()</span><br><span class="line">print(<span class="string">"f(f(x)) ="</span>, m.evaluate(f(f(x))))</span><br><span class="line">print(<span class="string">"f(x)    ="</span>, m.evaluate(f(x)))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#In Z3, we can also evaluate expressions in the model for a system of constraints. The following example shows how to use the evaluate method.</span></span><br><span class="line"></span><br><span class="line">x = Int(<span class="string">'x'</span>)</span><br><span class="line">y = Int(<span class="string">'y'</span>)</span><br><span class="line">f = Function(<span class="string">'f'</span>, IntSort(), IntSort())</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(f(f(x)) == x, f(x) == y, x != y)</span><br><span class="line">print(s.check())</span><br><span class="line">m = s.model()</span><br><span class="line">print(<span class="string">"f(f(x)) ="</span>, m.evaluate(f(f(x))))</span><br><span class="line">print(<span class="string">"f(x)    ="</span>, m.evaluate(f(x)))</span><br></pre></td></tr></table></figure>
<h3 id="可满足性和有效性">可满足性和有效性</h3>
<p>如果公式/约束F总是对未解释的符号赋值为真，则该公式/约束F是有效的。一个公式/约束F是可满足的，如果有适当的赋值给它的未解释的符号，在这个符号下F的值为真。有效性是指找到一个陈述的证据;可满足性是指找到一组约束的解决方案。考虑一个包含a和b公式F。我们可以问F是否有效,是否总是这样任意组合为a和b的值。如果F总是正确的,那么不是(F)永远是假的,然后不是(F)不会有任何令人满意的作业(例如,解决方案);也就是说，Not(F)是不能满足的。也就是说，当非(F)是不可满足的(是不可满足的)，F是有效的。或者，当且仅当非(F)是无效的(is invalid)时，F是可满足的。下面的例子证明了deMorgan定律。</p>
<p>下面的示例重新定义了Z3Py函数，证明它接收一个公式作为参数。此函数创建一个求解器，添加/断言公式的否定，并检查否定是否不可满足。这个函数的实现是Z3Py命令prove的一个更简单的版本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p, q = Bools(<span class="string">'p q'</span>)</span><br><span class="line">demorgan = And(p, q) == Not(Or(Not(p), Not(q)))</span><br><span class="line">print(demorgan)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prove</span><span class="params">(f)</span>:</span></span><br><span class="line">    s = Solver()</span><br><span class="line">    s.add(Not(f))</span><br><span class="line">    <span class="keyword">if</span> s.check() == unsat:</span><br><span class="line">        print(<span class="string">"proved"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"failed to prove"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Proving demorgan..."</span>)</span><br><span class="line">prove(demorgan)</span><br></pre></td></tr></table></figure>
<h3 id="list-comprehension">List comprehension</h3>
<p>Python支持</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create list [1, ..., 5] </span></span><br><span class="line">print([ x + <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">5</span>) ])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create two lists containing 5 integer variables</span></span><br><span class="line">X = [ Int(<span class="string">'x%s'</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>) ]</span><br><span class="line">Y = [ Int(<span class="string">'y%s'</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>) ]</span><br><span class="line">print(X)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a list containing X[i]+Y[i]</span></span><br><span class="line">X_plus_Y = [ X[i] + Y[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>) ]</span><br><span class="line">print(X_plus_Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a list containing X[i] &gt; Y[i]</span></span><br><span class="line">X_gt_Y = [ X[i] &gt; Y[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>) ]</span><br><span class="line">print(X_gt_Y)</span><br><span class="line"></span><br><span class="line">print(And(X_gt_Y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a 3x3 "matrix" (list of lists) of integer variables</span></span><br><span class="line">X = [ [ Int(<span class="string">"x_%s_%s"</span> % (i+<span class="number">1</span>, j+<span class="number">1</span>)) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>) ]</span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>) ]</span><br><span class="line">pp(X)</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，表达式"x%s"% i返回一个字符串，其中%s被替换为i的值。</p>
<p>命令pp与print类似，但是它对列表和元组使用Z3Py的格式化器，而不是Python的格式化器。</p>
<p>Z3Py还提供了创建布尔值、整数和实变量向量的函数。这些函数是使用列表理解实现的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">X = IntVector(<span class="string">'x'</span>, <span class="number">5</span>)</span><br><span class="line">Y = RealVector(<span class="string">'y'</span>, <span class="number">5</span>)</span><br><span class="line">P = BoolVector(<span class="string">'p'</span>, <span class="number">5</span>)</span><br><span class="line">print(X)</span><br><span class="line">print(Y)</span><br><span class="line">print(P)</span><br><span class="line">print([ y**<span class="number">2</span> <span class="keyword">for</span> y <span class="keyword">in</span> Y ])</span><br><span class="line">print(Sum([ y**<span class="number">2</span> <span class="keyword">for</span> y <span class="keyword">in</span> Y ]))</span><br><span class="line"></span><br><span class="line">[x__0, x__1, x__2, x__3, x__4]</span><br><span class="line">[y__0, y__1, y__2, y__3, y__4]</span><br><span class="line">[p__0, p__1, p__2, p__3, p__4]</span><br><span class="line">[y__0**<span class="number">2</span>, y__1**<span class="number">2</span>, y__2**<span class="number">2</span>, y__3**<span class="number">2</span>, y__4**<span class="number">2</span>]</span><br><span class="line">y__0**<span class="number">2</span> + y__1**<span class="number">2</span> + y__2**<span class="number">2</span> + y__3**<span class="number">2</span> + y__4**<span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="运动学方程">运动学方程</h3>
<p>在高中，学生学习运动学方程。这些方程描述了位移(d)、时间(t)、加速度(a)、初速度(v_i)和末速度(v_f)之间的数学关系。用Z3Py表示，我们可以把这些方程写成:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a, t ,v_i, v_f &#x3D; Reals(&#39;a t v__i v__f&#39;) #missing in HTML?</span><br><span class="line">d &#x3D;&#x3D; v_i * t + (a*t**2)&#x2F;2,</span><br><span class="line">v_f &#x3D;&#x3D; v_i + a*t</span><br></pre></td></tr></table></figure>
<p>问题1</p>
<p>Ima Hurryin正接近一个红绿灯，以每秒30.0米的速度行驶。灯变成黄色，Ima开始刹车并打滑停了下来。如果Ima的加速度是-8.00 m/s2，则确定汽车在打滑过程中的位移。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">d, a, t, v_i, v_f = Reals(<span class="string">'d a t v__i v__f'</span>)</span><br><span class="line"></span><br><span class="line">equations = [</span><br><span class="line">   d == v_i * t + (a*t**<span class="number">2</span>)/<span class="number">2</span>,</span><br><span class="line">   v_f == v_i + a*t,</span><br><span class="line">]</span><br><span class="line">print(<span class="string">"Kinematic equations:"</span>)</span><br><span class="line">print(equations)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Given v_i, v_f and a, find d</span></span><br><span class="line">problem = [</span><br><span class="line">    v_i == <span class="number">30</span>,</span><br><span class="line">    v_f == <span class="number">0</span>,</span><br><span class="line">    a   == <span class="number">-8</span></span><br><span class="line">]</span><br><span class="line">print(<span class="string">"Problem:"</span>)</span><br><span class="line">print(problem)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Solution:"</span>)</span><br><span class="line">solve(equations + problem)</span><br></pre></td></tr></table></figure>
<p>问题2 Ben Rushin正在等红灯。当它最终变成绿色时，本从静止开始以6.00米/s2的速度加速，持续了4.10秒。确定本的车在这段时间内的位移。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">d, a, t, v_i, v_f = Reals(<span class="string">'d a t v__i v__f'</span>)</span><br><span class="line"></span><br><span class="line">equations = [</span><br><span class="line">   d == v_i * t + (a*t**<span class="number">2</span>)/<span class="number">2</span>,</span><br><span class="line">   v_f == v_i + a*t,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Given v_i, t and a, find d</span></span><br><span class="line">problem = [</span><br><span class="line">    v_i == <span class="number">0</span>,</span><br><span class="line">    t   == <span class="number">4.10</span>,</span><br><span class="line">    a   == <span class="number">6</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">solve(equations + problem)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display rationals in decimal notation</span></span><br><span class="line">set_option(rational_to_decimal=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">solve(equations + problem)</span><br></pre></td></tr></table></figure>
<h3 id="bit-tricks">Bit Tricks</h3>
<p>一些底层的hacks在C程序员中非常流行。我们在z3的实现中使用了其中的一些技巧。</p>
<p>二的阶乘</p>
<p>这个hack经常在C程序中使用（包括z3）来测试一个机器整数是否为2的幂。我们可以用z3来证明它是有效的。当且仅当x是2的幂时，<code>x!=0&amp;&amp;!(x&amp;(x-1))</code>是正确的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">x      = BitVec(<span class="string">'x'</span>, <span class="number">32</span>)</span><br><span class="line">powers = [ <span class="number">2</span>**i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>) ]</span><br><span class="line">fast   = And(x != <span class="number">0</span>, x &amp; (x - <span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">slow   = Or([ x == p <span class="keyword">for</span> p <span class="keyword">in</span> powers ])</span><br><span class="line">print(fast)</span><br><span class="line">prove(fast == slow)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"trying to prove buggy version..."</span>)</span><br><span class="line">fast   = x &amp; (x - <span class="number">1</span>) == <span class="number">0</span></span><br><span class="line">prove(fast == slow)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">And(x != 0, x &amp; x - 1 == 0)</span></span><br><span class="line"><span class="string">proved</span></span><br><span class="line"><span class="string">trying to prove buggy version...</span></span><br><span class="line"><span class="string">counterexample</span></span><br><span class="line"><span class="string">[x = 0]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>相反数</p>
<p>下面的一个简单hack可以被用来检测两个机器整数是否是相反数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x      = BitVec(<span class="string">'x'</span>, <span class="number">32</span>)</span><br><span class="line">y      = BitVec(<span class="string">'y'</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Claim: (x ^ y) &lt; 0 iff x and y have opposite signs</span></span><br><span class="line">trick  = (x ^ y) &lt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Naive way to check if x and y have opposite signs</span></span><br><span class="line">opposite = Or(And(x &lt; <span class="number">0</span>, y &gt;= <span class="number">0</span>),</span><br><span class="line">              And(x &gt;= <span class="number">0</span>, y &lt; <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">prove(trick == opposite)</span><br></pre></td></tr></table></figure>
<h3 id="puzzles">Puzzles</h3>
<p>狗、猫和老鼠（鸡兔同笼问题）</p>
<p>思考下面的智力游戏（Puzzle）。花100美元买100个动物。狗要花15美元，猫要花1美元，老鼠要花25美分。你每种至少要买一个。你需要买多少？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create 3 integer variables</span></span><br><span class="line">dog, cat, mouse = Ints(<span class="string">'dog cat mouse'</span>)</span><br><span class="line">solve(dog &gt;= <span class="number">1</span>,   <span class="comment"># at least one dog</span></span><br><span class="line">      cat &gt;= <span class="number">1</span>,   <span class="comment"># at least one cat</span></span><br><span class="line">      mouse &gt;= <span class="number">1</span>, <span class="comment"># at least one mouse</span></span><br><span class="line">      <span class="comment"># we want to buy 100 animals</span></span><br><span class="line">      dog + cat + mouse == <span class="number">100</span>,</span><br><span class="line">      <span class="comment"># We have 100 dollars (10000 cents):</span></span><br><span class="line">      <span class="comment">#   dogs cost 15 dollars (1500 cents), </span></span><br><span class="line">      <span class="comment">#   cats cost 1 dollar (100 cents), and </span></span><br><span class="line">      <span class="comment">#   mice cost 25 cents </span></span><br><span class="line">      <span class="number">1500</span> * dog + <span class="number">100</span> * cat + <span class="number">25</span> * mouse == <span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<p>数独</p>
<p><img src="/2020/09/22/z3-solver/下载.png"></p>
<p>下面的例子将数度问题在z3中进行编码。不同的数独示例能够通过修改矩阵示例的方式解决。这个例子使用了很多list comprehensions。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 9x9 matrix of integer variables</span></span><br><span class="line">X = [ [ Int(<span class="string">"x_%s_%s"</span> % (i+<span class="number">1</span>, j+<span class="number">1</span>)) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># each cell contains a value in &#123;1, ..., 9&#125;</span></span><br><span class="line">cells_c  = [ And(<span class="number">1</span> &lt;= X[i][j], X[i][j] &lt;= <span class="number">9</span>)</span><br><span class="line">             <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># each row contains a digit at most once</span></span><br><span class="line">rows_c   = [ Distinct(X[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># each column contains a digit at most once</span></span><br><span class="line">cols_c   = [ Distinct([ X[i][j] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) ])</span><br><span class="line">             <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># each 3x3 square contains a digit at most once</span></span><br><span class="line">sq_c     = [ Distinct([ X[<span class="number">3</span>*i0 + i][<span class="number">3</span>*j0 + j]</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>) ])</span><br><span class="line">             <span class="keyword">for</span> i0 <span class="keyword">in</span> range(<span class="number">3</span>) <span class="keyword">for</span> j0 <span class="keyword">in</span> range(<span class="number">3</span>) ]</span><br><span class="line"></span><br><span class="line">sudoku_c = cells_c + rows_c + cols_c + sq_c</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudoku instance, we use '0' for empty cells</span></span><br><span class="line">instance = ((<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">8</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">instance_c = [ If(instance[i][j] == <span class="number">0</span>,</span><br><span class="line">                  <span class="literal">True</span>,</span><br><span class="line">                  X[i][j] == instance[i][j])</span><br><span class="line">               <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">s.add(sudoku_c + instance_c)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    r = [ [ m.evaluate(X[i][j]) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line">          <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) ]</span><br><span class="line">    print_matrix(r)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"failed to solve"</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># Let us remove 9 from the first row and see if there is more than one solution</span></span><br><span class="line"></span><br><span class="line">instance = ((<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">8</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">            (<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">instance_c = [ If(instance[i][j] == <span class="number">0</span>,</span><br><span class="line">                  <span class="literal">True</span>,</span><br><span class="line">                  X[i][j] == instance[i][j])</span><br><span class="line">               <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>) ]    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n_solutions</span><span class="params">(n)</span>:</span></span><br><span class="line">    s = Solver()</span><br><span class="line">    s.add(sudoku_c + instance_c)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> s.check() == sat <span class="keyword">and</span> i &lt; n:</span><br><span class="line">        m = s.model()</span><br><span class="line">        print([[ m.evaluate(X[i][j]) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>)])</span><br><span class="line">        fml = And([X[i][j] == m.evaluate(X[i][j]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>)])</span><br><span class="line">        s.add(Not(fml))</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">n_solutions(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>这里的If是lisp风格的写法</p>
<p>八皇后问题</p>
<p>八皇后难题是将8个国际象棋皇后放在8x8的棋盘上，这样就不会有两个皇后互相攻击。因此，解决方案要求两个皇后不能共享同一行、列或对角线。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We know each queen must be in a different row.</span></span><br><span class="line"><span class="comment"># So, we represent each queen by a single integer: the column position</span></span><br><span class="line">Queens = [ Int(<span class="string">'Q_%i'</span> % (i + <span class="number">1</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Each queen is in a column &#123;1, ... 8 &#125;</span></span><br><span class="line">val_c = [ And(<span class="number">1</span> &lt;= Queens[i], Queens[i] &lt;= <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># At most one queen per column</span></span><br><span class="line">col_c = [ Distinct(Queens) ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Diagonal constraint</span></span><br><span class="line">diag_c = [ If(i == j,</span><br><span class="line">              <span class="literal">True</span>,</span><br><span class="line">              And(Queens[i] - Queens[j] != i - j, Queens[i] - Queens[j] != j - i))</span><br><span class="line">           <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(i) ]</span><br><span class="line"></span><br><span class="line">solve(val_c + col_c + diag_c)</span><br></pre></td></tr></table></figure>
<h3 id="应用安装问题">应用：安装问题</h3>
<p>安装问题包括确定是否可以在系统中安装一组新的软件包。这个应用程序时基于OPIUM：最优的包安装/卸载管理器。许多包依赖于其他包来提供一些功能。每个发行版都包含一个元数据文件，解释发行版的每个包的需求。元数据包含诸如名称、版本等细节。更重要的是，它包含了依赖和冲突条款，规定了哪些包应该安装在系统上。</p>
<p>使用z3可以很容易解决安装问题。它的思想是为每个包定义一个布尔变量。如果包必须在系统中，则此变量为真。如果a包依赖于b、c和z包，我们按照如下的方式写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">a, b, c, d, e, f, g, z = Bools(<span class="string">'a b c d e f g z'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#DependsOn(a, [b, c, z])</span></span><br><span class="line"><span class="comment">#DependsOn is a simple Python function that creates Z3 constraints that capture the depends clause semantics.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DependsOn</span><span class="params">(pack, deps)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> And([ Implies(pack, dep) <span class="keyword">for</span> dep <span class="keyword">in</span> deps ])</span><br><span class="line"></span><br><span class="line"><span class="comment">#Thus, DependsOn(a, [b, c, z]) generates the constraint</span></span><br><span class="line"><span class="comment"># And(Implies(a, b), Implies(a, c), Implies(a, z))</span></span><br><span class="line"></span><br><span class="line">print(DependsOn(a, [b, c, z]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#That is, if users install package a, they must also install packages b, c and z.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#If package d conflicts with package e, we write Conflict(d, e). Conflict is also a simple Python function.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Conflict</span><span class="params">(p1, p2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Or(Not(p1), Not(p2))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Conflict(d, e) generates the constraint Or(Not(d), Not(e)). </span></span><br><span class="line"><span class="comment"># With these two functions, we can easily encode the example </span></span><br><span class="line"><span class="comment"># in the Opium article (Section 2) in Z3Py as:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DependsOn</span><span class="params">(pack, deps)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> And([ Implies(pack, dep) <span class="keyword">for</span> dep <span class="keyword">in</span> deps ])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Conflict</span><span class="params">(p1, p2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Or(Not(p1), Not(p2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">solve(DependsOn(a, [b, c, z]),</span><br><span class="line">      DependsOn(b, [d]),</span><br><span class="line">      DependsOn(c, [Or(d, e), Or(f, g)]),</span><br><span class="line">      Conflict(d, e),</span><br><span class="line">      a, z)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DependsOn</span><span class="params">(pack, deps)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> And([ Implies(pack, dep) <span class="keyword">for</span> dep <span class="keyword">in</span> deps ])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Conflict</span><span class="params">(p1, p2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Or(Not(p1), Not(p2))</span><br><span class="line"></span><br><span class="line">a, b, c, d, e, f, g, z = Bools(<span class="string">'a b c d e f g z'</span>)</span><br><span class="line"></span><br><span class="line">solve(DependsOn(a, [b, c, z]),</span><br><span class="line">      DependsOn(b, [d]),</span><br><span class="line">      DependsOn(c, [Or(d, e), Or(f, g)]),</span><br><span class="line">      Conflict(d, e),</span><br><span class="line">      a, z)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">install_check</span><span class="params">(*problem)</span>:</span></span><br><span class="line">    s = Solver()</span><br><span class="line">    s.add(*problem)</span><br><span class="line">    <span class="keyword">if</span> s.check() == sat:</span><br><span class="line">        m = s.model()</span><br><span class="line">        r = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> m:</span><br><span class="line">            <span class="keyword">if</span> is_true(m[x]):</span><br><span class="line">                <span class="comment"># x is a Z3 declaration</span></span><br><span class="line">                <span class="comment"># x() returns the Z3 expression</span></span><br><span class="line">                <span class="comment"># x.name() returns a string</span></span><br><span class="line">                r.append(x())</span><br><span class="line">        print(r)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"invalid installation profile"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Check 1"</span>)</span><br><span class="line">install_check(DependsOn(a, [b, c, z]),</span><br><span class="line">              DependsOn(b, [d]),</span><br><span class="line">              DependsOn(c, [Or(d, e), Or(f, g)]),</span><br><span class="line">              Conflict(d, e),</span><br><span class="line">              Conflict(d, g),</span><br><span class="line">              a, z)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Check 2"</span>)</span><br><span class="line">install_check(DependsOn(a, [b, c, z]),</span><br><span class="line">              <span class="comment">#DependsOn(b, d),</span></span><br><span class="line">              DependsOn(b, [d]),</span><br><span class="line">              DependsOn(c, [Or(d, e), Or(f, g)]),</span><br><span class="line">              Conflict(d, e),</span><br><span class="line">              Conflict(d, g),</span><br><span class="line">              a, z, g)</span><br></pre></td></tr></table></figure>
<h2 id="对于同余方程">对于同余方程</h2>
<p>https://www.dcode.fr/modular-equation-solver</p>
<p>https://github.com/55-AA/mod_equations</p>
<h2 id="参考资料">参考资料</h2>
<p>https://github.com/Z3Prover/z3/wiki/Documentation</p>
<p>https://rise4fun.com/z3/tutorial/guide</p>
<p>https://github.com/Z3Prover/z3/tree/master/examples/python/tutorial/jupyter</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Risuxx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://risuxx.github.io/2020/09/22/z3-solver/">https://risuxx.github.io/2020/09/22/z3-solver/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://risuxx.github.io" target="_blank">Risuxx's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a></div><div class="post_share"><div class="social-share" data-image="https://pic4.zhimg.com/80/v2-b76becbb2b3049c8507293bd4dfbf8b7_720w.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/10/04/reverse-3/"><img class="prev_cover" src="https://pic3.zhimg.com/80/v2-de49c5297197da2e6a544e39026aad8a_720w.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">reverse_3</div></div></a></div><div class="next-post pull_right"><a href="/2020/09/10/battlefield/"><img class="next_cover" src="http://img.ewebweb.com/uploads/20200102/21/1577972384-XszAmnbvie.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">battlefield</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Risuxx</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>